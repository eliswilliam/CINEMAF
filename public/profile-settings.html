<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="img/favicon.ico"/>
    <title>Configurações de Perfil | CineHome</title>
    <link rel="stylesheet" href="profile-settings.css">
    <link rel="stylesheet" href="notifications.css">
</head>
<body>
    <a href="home.html" class="back-link">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Voltar
    </a>

    <div class="settings-container">
        <div class="settings-header">
            <h1 class="settings-title">Configurações de perfil</h1>
        </div>

        <div class="profile-list" id="profile-list">
            <div class="profile-card" data-profile="01">
                <div class="profile-info">
                    <img src="imagens/avatar-01.svg" alt="Perfil 01" class="profile-avatar">
                    <span class="profile-number">01</span>
                </div>
                <div class="profile-actions">
                    <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                    </svg>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </div>
            </div>

            <div class="profile-card" data-profile="02">
                <div class="profile-info">
                    <img src="imagens/avatar-02.svg" alt="Perfil 02" class="profile-avatar">
                    <span class="profile-number">02</span>
                </div>
                <div class="profile-actions">
                    <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                    </svg>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </div>
            </div>

            <div class="profile-card" data-profile="03">
                <div class="profile-info">
                    <img src="imagens/avatar-03.svg" alt="Perfil 03" class="profile-avatar">
                    <span class="profile-number">03</span>
                </div>
                <div class="profile-actions">
                    <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                    </svg>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </div>
            </div>

            <div class="profile-card" data-profile="04">
                <div class="profile-info">
                    <img src="imagens/avatar-04.svg" alt="Perfil 04" class="profile-avatar">
                    <span class="profile-number">04</span>
                </div>
                <div class="profile-actions">
                    <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                    </svg>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </div>
            </div>

            <div class="profile-card" data-profile="05">
                <div class="profile-info">
                    <img src="imagens/avatar-05.svg" alt="Perfil 05" class="profile-avatar">
                    <span class="profile-number">05</span>
                </div>
                <div class="profile-actions">
                    <svg class="lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                    </svg>
                    <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </div>
            </div>
        </div>

        <button class="done-button" onclick="window.location.href='home.html'">CONCLUÍDO</button>
    </div>

    <!-- Modal de edição de perfil -->
    <div class="edit-modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Editar Perfil <span id="modalProfileNumber"></span></h2>
                <p class="modal-subtitle">Configure o nome e a senha do perfil</p>
            </div>

            <form id="editProfileForm">
                <div class="form-group">
                    <label for="profileName">Nome do Perfil</label>
                    <input type="text" id="profileName" placeholder="Digite o nome do perfil" maxlength="20">
                </div>

                <div class="lock-option">
                    <input type="checkbox" id="lockProfile" class="lock-checkbox">
                    <label for="lockProfile" class="lock-label">Bloquear este perfil com senha</label>
                </div>

                <div class="form-group password-toggle" id="passwordGroup" style="display: none;">
                    <label for="profilePassword">Senha do Perfil</label>
                    <input type="password" id="profilePassword" placeholder="Digite a senha (4 dígitos)" maxlength="4">
                    <button type="button" class="toggle-password-btn" onclick="togglePassword()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn-save">
                        <span class="btn-text">Salvar</span>
                        <span class="btn-loader" style="display: none;">
                            <svg class="spinner" viewBox="0 0 50 50">
                                <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
                            </svg>
                        </span>
                    </button>
                    <button type="button" class="btn-cancel" onclick="closeModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let currentProfileId = null;

        // Load saved profiles
        function loadProfiles() {
            const profiles = JSON.parse(localStorage.getItem('cinehome_profiles') || '{}');
            document.querySelectorAll('.profile-card').forEach(card => {
                const profileId = card.getAttribute('data-profile');
                const profile = profiles[profileId];
                
                if (profile && profile.name) {
                    const numberSpan = card.querySelector('.profile-number');
                    numberSpan.textContent = profile.name;
                }
                
                // Update lock icon if profile is locked
                const lockIcon = card.querySelector('.lock-icon');
                if (profile && profile.locked) {
                    lockIcon.style.color = '#5555FF';
                    // Change to locked icon
                    lockIcon.innerHTML = `
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    `;
                } else {
                    lockIcon.style.color = 'rgba(255, 255, 255, 0.5)';
                    // Change to unlocked icon
                    lockIcon.innerHTML = `
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                    `;
                }
            });
        }

        // Handle profile card clicks
        document.querySelectorAll('.profile-card').forEach(card => {
            card.addEventListener('click', function() {
                const profileId = this.getAttribute('data-profile');
                openModal(profileId);
            });
        });

        function openModal(profileId) {
            currentProfileId = profileId;
            const modal = document.getElementById('editModal');
            const modalNumber = document.getElementById('modalProfileNumber');
            const profileName = document.getElementById('profileName');
            const lockCheckbox = document.getElementById('lockProfile');
            const profilePassword = document.getElementById('profilePassword');
            
            modalNumber.textContent = profileId;
            
            // Load saved data
            const profiles = JSON.parse(localStorage.getItem('cinehome_profiles') || '{}');
            const profile = profiles[profileId] || {};
            
            profileName.value = profile.name || '';
            lockCheckbox.checked = profile.locked || false;
            profilePassword.value = profile.password || '';
            
            togglePasswordField();
            modal.classList.add('active');
        }

        function closeModal() {
            const modal = document.getElementById('editModal');
            modal.classList.remove('active');
            currentProfileId = null;
        }

        // Toggle password field visibility
        document.getElementById('lockProfile').addEventListener('change', togglePasswordField);

        function togglePasswordField() {
            const lockCheckbox = document.getElementById('lockProfile');
            const passwordGroup = document.getElementById('passwordGroup');
            passwordGroup.style.display = lockCheckbox.checked ? 'block' : 'none';
        }

        function togglePassword() {
            const input = document.getElementById('profilePassword');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // Handle form submission
        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const profileName = document.getElementById('profileName').value;
            const lockCheckbox = document.getElementById('lockProfile').checked;
            const profilePassword = document.getElementById('profilePassword').value;
            const saveBtn = this.querySelector('.btn-save');
            const btnText = saveBtn.querySelector('.btn-text');
            const btnLoader = saveBtn.querySelector('.btn-loader');
            
            // Validate
            if (lockCheckbox && (!profilePassword || profilePassword.length !== 4)) {
                notify.error('Senha inválida', 'A senha deve ter exatamente 4 dígitos!');
                return;
            }
            
            // Show loading
            saveBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoader.style.display = 'inline-block';
            
            // Simulate save delay (for UX feedback)
            setTimeout(() => {
                // Save to localStorage
                const profiles = JSON.parse(localStorage.getItem('cinehome_profiles') || '{}');
                profiles[currentProfileId] = {
                    name: profileName || currentProfileId,
                    locked: lockCheckbox,
                    password: lockCheckbox ? profilePassword : null
                };
                localStorage.setItem('cinehome_profiles', JSON.stringify(profiles));
                
                // Update UI
                loadProfiles();
                
                // Hide loading
                saveBtn.disabled = false;
                btnText.style.display = 'inline-block';
                btnLoader.style.display = 'none';
                
                // Close modal
                closeModal();
                
                // Show success notification
                notify.success('Perfil salvo!', `As configurações do perfil ${profileName || currentProfileId} foram salvas com sucesso.`);
            }, 800);
        });

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Load profiles on page load
        loadProfiles();
    </script>
    <script src="notifications.js"></script>
</body>
</html>
